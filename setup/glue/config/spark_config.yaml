# Spark Configuration for Glue Iceberg Tables
spark:
  app_name: "TPC-DS Glue Iceberg Tables"
  master: "local[*]"
  config:
    # Iceberg extensions
    "spark.sql.extensions": "org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions"
    "spark.sql.catalog.glue_catalog": "org.apache.iceberg.spark.SparkCatalog"
    "spark.sql.catalog.glue_catalog.catalog-impl": "org.apache.iceberg.aws.glue.GlueCatalog"
    "spark.sql.catalog.glue_catalog.warehouse": "${AWS_S3_ICEBERG_GLUE_PATH}"
    "spark.sql.catalog.glue_catalog.io-impl": "org.apache.iceberg.aws.s3.S3FileIO"
    
    # AWS configuration
    "spark.hadoop.fs.s3a.aws.credentials.provider": "com.amazonaws.auth.DefaultAWSCredentialsProviderChain"
    "spark.hadoop.fs.s3a.aws.region": "${AWS_REGION}"
    "spark.hadoop.fs.s3a.impl": "org.apache.hadoop.fs.s3a.S3AFileSystem"
    "spark.hadoop.fs.s3a.path.style.access": "true"
    
    # Iceberg table properties
    "spark.sql.catalog.glue_catalog.table-default.write.format.default": "parquet"
    "spark.sql.catalog.glue_catalog.table-default.write.parquet.compression-codec": "snappy"
    "spark.sql.catalog.glue_catalog.table-default.write.target-file-size-bytes": "134217728"
    "spark.sql.catalog.glue_catalog.table-default.write.distribution-mode": "hash"
    
    # Memory and performance
    "spark.driver.memory": "4g"
    "spark.driver.maxResultSize": "2g"
    "spark.executor.memory": "4g"
    "spark.sql.adaptive.enabled": "true"
    "spark.sql.adaptive.coalescePartitions.enabled": "true"
    "spark.jars.packages": "org.apache.iceberg:iceberg-spark-runtime-3.3_2.12:1.4.2,org.apache.iceberg:iceberg-aws:1.4.2,software.amazon.awssdk:bundle:2.20.66"

# JAR files (relative to project root)
# Note: For Glue 4.0 (Spark 3.3), use Spark 3.3-compatible JARs
jars:
  - "setup/glue/libs/jars/iceberg-aws-1.4.2.jar"
  - "setup/glue/libs/jars/iceberg-spark-runtime-3.3_2.12-1.4.2.jar"

# Logging
logging:
  level: "INFO"
  file: "logs/spark.log"
